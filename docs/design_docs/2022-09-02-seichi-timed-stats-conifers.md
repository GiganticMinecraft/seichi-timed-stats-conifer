# 時系列統計データストアとしての `seichi-timed-stats-conifers`

## 文脈

(TODO: SeichiRanking の現状を説明する)

ランキングシステムは、「プレーヤーデータの(整地鯖システム内での)公開」、「過去のプレーヤーデータの蓄積とアクセス」及び「ランキング情報の計算とそのキャッシュの保持」の三つの機能を組み合わせて初めてバックエンドの機能が実現できる。

新システムの設計においては、これら三つの機能は独立した機能だと考え、各々をマイクロサービスのコンポーネントとして実装することにした。本ドキュメントの関心の対象である `seichi-timed-stats-conifers` は、「過去のプレーヤーデータの蓄積とアクセス」を実現するシステムとして設計する。

## 目標

### 実現すべきこと (Goals)

#### 機能要件

- 全プレーヤーの各種統計量(とりあえずは整地量、建築量、プレイティック数、投票数)を、統計量を読み取った正確なタイミングとともに蓄積することができる
- 任意に与えられた時刻について、その時刻の直前に蓄積された全プレーヤーの統計量データを読み出すことができる

#### 非機能要件

- 過去の統計量データの読み出しは 1 秒程度で完了するのが望ましい
- データの蓄積に使う形式は、ディスク使用量が少ないものであることが望ましい

### 実現しないこと (non-Goals)

- ランキング情報の生成。これは、 `seichi-timed-stats-conifers` に対して API 呼び出しを行うような別コンポーネントにて実装する。

## どのように実現するか

(TODO)

## 検討した代替案 (Alternatives Considered)

(TODO)

## 備考

### 名前の由来について

[どのように実現するか](#どのように実現するか) の節で説明したように、 `seichi-timed-stats-conifers` は「大きな枝分かれが基本的に発生しないような、親ノードとの差分を記録する木構造の集まり」にて時系列上の統計量データを記録する。

(グラフ理論的な)木の集まりは(グラフ理論的な)森と呼ばれており、「枝分かれが少ない木の集合」を @kory33 が「針葉樹林みたいだなぁ」と思ったことから、 `conifers` という名前を付けることになった。

![Abies lasiocarpa](../400px-Abies_lasiocarpa_5922.jpg)

[Abies lasiocarpa 5922](https://commons.wikimedia.org/wiki/File:Abies_lasiocarpa_5922.JPG), by Walter Siegmund.

